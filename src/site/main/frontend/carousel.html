<div class="carousel">
    <div class="carousel-track">
        <div class="carousel-slide is-active">
            <div class="has-text-centered carousel-slide-inner">
                {% if example == "quickstart" %}
                    <div class="has-text-centered p-4 quickstart-bg">
                        <div style="background: #f0f4ff; border-radius: 8px; padding: 1rem 0 0.5rem 0; margin-bottom: 1.2rem;">
                            <h4 class="title is-4 mb-2 has-text-primary carousel-title">
                                {{ title }}
                            </h4>
                            <p class="mb-3" style="font-style: italic;">
                                {{ description }}
                            </p>
                        </div>
                        <div class="code-block mt-4 language-html" data-lang="html" style="text-align:left;">
                            <span style="color:#ff6b6b;">&lt;script</span> <span style="color:#4ecdc4;">src</span>=<span style="color:#ffe66d;">"https://unpkg.com/htmx.org@2.0.6"</span><span style="color:#ff6b6b;">&gt;&lt;/script&gt;</span>
                        </div>
                        <a href="/docs/getting-started#docs-container" onclick="window.location=this.href; return false;">Get started! </a>
                {% elif example == "like" %}
                    <div class="has-text-centered p-4">
                        <h4 class="title is-4 mb-2 has-text-primary carousel-title">
                            {{ title }}
                        </h4>
                        <p class="mb-3" style="font-style: italic;">
                            {{ description }}
                        </p>
                        <div id="htmx-code-demo">
                            <div class='code-block mt-4'  >
                                <span style="color:#ff6b6b;">&lt;button</span> <span style="color:#4ecdc4;">hx-post</span>=<span style="color:#ffe66d;">"/like"</span> <span style="color:#4ecdc4;">hx-target</span>=<span style="color:#ffe66d;">"#result"</span> <span style="color:#4ecdc4;">hx-swap</span>=<span style="color:#ffe66d;">"outerHTML"</span><span style="color:#ff6b6b;">&gt;</span>Like<span style="color:#ff6b6b;">&lt;/button&gt;</span>
                                <div class='has-text-grey mt-2' style='font-size:0.95em;'>A button that sends a POST request to /like and updates #result.</div>
                                <button class="button is-info mt-3"
                                        hx-post="/carousel/like/codeblock/"
                                        hx-target="#htmx-code-demo"
                                        hx-swap="outerHTML">
                                    Show another HTMX Example
                                </button>
                            </div>
                        </div>
                    </div>
                {% elif example == "live-search" %}
                    <div class="live-search-demo p-4" style="width: 100%;">
                        <h4 class="title is-4 mb-2 has-text-primary carousel-title">
                            {{ title }}
                        </h4>
                        <p class="mb-3" style="font-style: italic;">
                            {{ description }}
                        </p>
                        <div style="display: flex; flex-direction: column; align-items: flex-start; position: relative; width: 100%;">
                            <input class="input is-medium mt-4"
                                id="carousel-live-search-input"
                                type="text"
                                placeholder="Type to search..."
                                name="q"
                                autocomplete="off"
                                hx-get="/carousel/live-search/result/"
                                hx-target="#carousel-search-result"
                                hx-trigger="keyup changed delay:300ms"
                                style="max-width: 100%; width: 100%; margin-bottom: 0;">
                            <div id="carousel-search-result" class="mt-2"
                                 style="width: 100%; min-width: 320px; position: absolute; left: 0; top: 58px; z-index: 100;"></div>
                        </div>
                        <div class="code-block mt-4" style="width: 100%; min-width: 320px; text-align:left;">
                            <span style="color:#ff6b6b;">&lt;input</span>
                                <span style="color:#4ecdc4;">name</span>=<span style="color:#ffe66d;">"q"</span>
                                <span style="color:#4ecdc4;">hx-get</span>=<span style="color:#ffe66d;">"/carousel/live-search/result/"</span>
                                <span style="color:#4ecdc4;">hx-target</span>=<span style="color:#ffe66d;">"#carousel-search-result"</span>
                                <span style="color:#4ecdc4;">hx-trigger</span>=<span style="color:#ffe66d;">"keyup changed delay:300ms"</span>
                            <span style="color:#ff6b6b;">/&gt;</span>
                        </div>
                    </div>
                    <script>
                    (function() {
                        let selectedIdx = -1;
                        let results = [];
                        const input = document.getElementById('carousel-live-search-input');
                        const resultsDiv = document.getElementById('carousel-search-result');

                        // Helper to update highlight
                        function updateHighlight() {
                            const items = resultsDiv ? resultsDiv.querySelectorAll('li') : [];
                            items.forEach((li, i) => {
                                if (i === selectedIdx) {
                                    li.classList.add('is-active');
                                    li.setAttribute('aria-selected', 'true');
                                } else {
                                    li.classList.remove('is-active');
                                    li.removeAttribute('aria-selected');
                                }
                            });
                        }

                        // Click to select
                        document.body.addEventListener('click', function(e) {
                            var li = e.target.closest('.live-search-results li');
                            if (li && input) {
                                input.value = li.textContent.trim();
                                if (resultsDiv) resultsDiv.innerHTML = '';
                                selectedIdx = -1;
                            }
                        });

                        // Keyboard navigation
                        if (input) {
                            input.addEventListener('keydown', function(e) {
                                const items = resultsDiv ? resultsDiv.querySelectorAll('li') : [];
                                if (!items.length) return;
                                if (e.key === "ArrowDown") {
                                    e.preventDefault();
                                    selectedIdx = (selectedIdx + 1) % items.length;
                                    updateHighlight();
                                    items[selectedIdx].scrollIntoView({block: "nearest"});
                                } else if (e.key === "ArrowUp") {
                                    e.preventDefault();
                                    selectedIdx = (selectedIdx - 1 + items.length) % items.length;
                                    updateHighlight();
                                    items[selectedIdx].scrollIntoView({block: "nearest"});
                                } else if (e.key === "Enter") {
                                    if (selectedIdx >= 0 && items[selectedIdx]) {
                                        input.value = items[selectedIdx].textContent.trim();
                                        if (resultsDiv) resultsDiv.innerHTML = '';
                                        selectedIdx = -1;
                                    }
                                } else {
                                    selectedIdx = -1;
                                    updateHighlight();
                                }
                            });
                        }

                        // Reset highlight on new results
                        document.body.addEventListener('htmx:afterSwap', function(evt) {
                            if (evt.detail.target && evt.detail.target.id === "carousel-search-result") {
                                selectedIdx = -1;
                                updateHighlight();
                            }
                        });
                    })();
                    </script>
                {% elif example == "ticker" %}
                    <div class="has-text-centered p-4" style="background: #f0f4ff; border-radius: 8px; padding: 1rem 0 0.5rem 0; margin-bottom: 1.2rem;">
                        <h4 class="title is-4 mb-2 has-text-primary carousel-title">
                            {{ title }}
                        </h4>
                        <p class="mb-3" style="font-style: italic;">
                            {{ description }}
                        </p>
                        <div id="carousel-ticker-result"
                             hx-get="/carousel/ticker/result/"
                             hx-trigger="load, every 2s"
                             hx-swap="innerHTML"
                             hx-target="#q"
                             style="margin: 0 auto; max-width: 340px;">
                            <span class="icon"><i class="fab fa-btc fa-spin"></i></span>
                            <span>Loading price...</span>
                        </div>
                        <div class="code-block mt-4" style="width: 100%; text-align:left;" id="q">
                            <span style="color:#ff6b6b;">&lt;div</span>
                                <span style="color:#4ecdc4;">hx-get</span>=<span style="color:#ffe66d;">"/carousel/ticker/result/"</span>
                                <span style="color:#4ecdc4;">hx-trigger</span>=<span style="color:#ffe66d;">"load, every 3s"</span>
                                <span style="color:#4ecdc4;">hx-swap</span>=<span style="color:#ffe66d;">"innerHTML"</span>
                            <span style="color:#ff6b6b;">&gt;</span>...<span style="color:#ff6b6b;">&lt;/div&gt;</span>
                        </div>
                    </div>
                {% else %}
                    <div class="notification is-warning is-light">No example found for this id.</div>
                {% endif %}
                <div class="mt-3">

                </div>
            </div>
        </div>
    </div>
    <button class="carousel-nav carousel-prev" aria-label="Previous">
        <span class="icon"><i class="fas fa-chevron-left"></i></span>
    </button>
    <button class="carousel-nav carousel-next" aria-label="Next">
        <span class="icon"><i class="fas fa-chevron-right"></i></span>
    </button>
    <div class="carousel-indicators">
        <span class="carousel-dot {% if id == 'quickstart' %}is-active{% endif %}" data-slide="0"></span>
        <span class="carousel-dot {% if id == 'like' %}is-active{% endif %}" data-slide="1"></span>
        <span class="carousel-dot {% if id == 'live-search' %}is-active{% endif %}" data-slide="2"></span>
        <span class="carousel-dot {% if id == 'polling' %}is-active{% endif %}" data-slide="3"></span>
    </div>
</div>
<script>
(function() {
    // Carousel order
    const ids = ["quickstart", "like", "live-search", "polling"];
    let current = ids.indexOf("{{ id }}");
    const prevBtn = document.querySelector('.carousel-prev');
    const nextBtn = document.querySelector('.carousel-next');
    const dots = Array.from(document.querySelectorAll('.carousel-dot'));
    function goTo(idx) {
        if (idx < 0) idx = ids.length - 1;
        if (idx >= ids.length) idx = 0;
        htmx.ajax('GET', '/carousel/' + ids[idx] + '/', '.carousel');
    }
    if (prevBtn) prevBtn.onclick = function() { goTo(current - 1); };
    if (nextBtn) nextBtn.onclick = function() { goTo(current + 1); };
    dots.forEach((dot, i) => {
        dot.onclick = function() { goTo(i); };
    });
})();
</script>