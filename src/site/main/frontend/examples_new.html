{% extends "_base.html" %}
{% load static %}
{% block content %}
<div class="section" style="padding-top: 5rem;">
  <div class="container">
    <div class="columns">
      <!-- Left menu (desktop) -->
      <div class="column is-3 is-hidden-mobile">
        <aside class="menu" style="max-height: 70vh; overflow-y: auto;">
          <p class="menu-label">Examples</p>
          <div class="field mb-3">
            <div class="control has-icons-left">
              <input class="input is-small" type="text" placeholder="Search examples..." id="example-menu-search">
              <span class="icon is-left">
                <i class="fas fa-search"></i>
              </span>
            </div>
          </div>
          <ul class="menu-list" id="example-menu-list">
            {% for example in examples %}
              <li>
                <a
                  hx-get="/demo/{{ example.id }}.html"
                  hx-target="#example-detail"
                  hx-swap="innerHTML"
                  hx-push-url="/examples/{{ example.id }}"
                  class="example-link"
                  id="example-link-{{ example.id }}"
                  href="/examples/{{ example.id }}"
                  data-title="{{ example.title|lower }}"
                  >
                  {{ example.title }}
                </a>
              </li>
            {% endfor %}
          </ul>
        </aside>
      </div>
      <!-- Dropdown menu (mobile) -->
      <div class="column is-12 is-hidden-tablet mb-4">
        <div class="field">
          <div class="control">
            <div class="select is-fullwidth">
              <select id="examples-dropdown">
                <option value="">Select an example...</option>
                {% for example in examples %}
                  <option value="{{ example.id }}">{{ example.title }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>
      </div>
      <!-- Central example display -->
      <div class="column is-9-desktop is-12-mobile">
        <div id="example-detail">
          <div class="notification is-info is-light">
            <strong>Select an example from the menu to view it here.</strong>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  // Highlight the active example link (desktop)
  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('example-link')) {
      document.querySelectorAll('.example-link').forEach(function(link) {
        link.classList.remove('is-active');
      });
      e.target.classList.add('is-active');
    }
  });

  // Search/filter for the left menu
  document.addEventListener('DOMContentLoaded', function() {
    var searchInput = document.getElementById('example-menu-search');
    var menuList = document.getElementById('example-menu-list');
    if (searchInput && menuList) {
      searchInput.addEventListener('input', function() {
        var q = this.value.trim().toLowerCase();
        menuList.querySelectorAll('li').forEach(function(li) {
          var a = li.querySelector('a');
          if (!q || (a && a.getAttribute('data-title').includes(q))) {
            li.style.display = '';
          } else {
            li.style.display = 'none';
          }
        });
      });
    }

    // Handle dropdown change (mobile)
    var dropdown = document.getElementById('examples-dropdown');
    if (dropdown) {
      dropdown.addEventListener('change', function() {
        var exampleId = this.value;
        if (exampleId) {
          htmx.ajax('GET', '/demo/' + exampleId + '.html', '#example-detail');
          history.pushState({}, '', '/examples/' + exampleId);
        }
      });
    }

    // On page load, check if URL is /examples/<example_id> and load that example
    var match = window.location.pathname.match(/^\/examples\/([a-zA-Z0-9_-]+)$/);
    if (match) {
      var exampleId = match[1];
      htmx.ajax('GET', '/demo/' + exampleId + '.html', '#example-detail');
      // Optionally highlight the link
      var activeLink = document.getElementById('example-link-' + exampleId);
      if (activeLink) {
        document.querySelectorAll('.example-link').forEach(function(link) {
          link.classList.remove('is-active');
        });
        activeLink.classList.add('is-active');
      }
    }
  });

  // Listen for popstate to handle browser back/forward navigation
  window.addEventListener('popstate', function() {
    var match = window.location.pathname.match(/^\/examples\/([a-zA-Z0-9_-]+)$/);
    if (match) {
      var exampleId = match[1];
      htmx.ajax('GET', '/demo/' + exampleId + '.html', '#example-detail');
      var activeLink = document.getElementById('example-link-' + exampleId);
      if (activeLink) {
        document.querySelectorAll('.example-link').forEach(function(link) {
          link.classList.remove('is-active');
        });
        activeLink.classList.add('is-active');
      }
    }
  });
</script>
<style>
/* Ensure the left menu is hidden on mobile, dropdown hidden on desktop */
@media (max-width: 768px) {
  .is-hidden-tablet { display: block !important; }
  .is-hidden-mobile { display: none !important; }
}
@media (min-width: 769px) {
  .is-hidden-tablet { display: none !important; }
  .is-hidden-mobile { display: block !important; }
}
</style>
{% endblock %}